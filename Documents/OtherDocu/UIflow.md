# 画面遷移図（鍵管理システム）

本節では、要求定義およびユースケースをもとに、鍵管理システムの画面構成と画面遷移を定義する。

---

## 画面一覧

| 画面ID | 画面名         | 利用者 | 概要             |
| :--- | :---------- | :-- | :------------- |
| S-1  | トップ（貸出状況一覧） | 利用者 | 鍵の一覧と現在の状態を表示  |
| S-2  | 鍵の貸出画面      | 利用者 | 利用者選択・鍵選択を行い貸出 |
| S-3  | 鍵の返却画面      | 利用者 | 利用者選択・鍵選択を行い返却 |
| S-4  | 管理者ログイン画面   | 管理者 | 管理者認証を行う       |
| S-5  | 履歴一覧画面      | 管理者 | 貸出・返却履歴を閲覧     |

---

## 画面遷移定義

* 利用者はトップ画面（S-1）から、貸出画面（S-2）または返却画面（S-3）へ遷移できる
* 管理者はトップ画面（S-1）から管理者ログイン画面（S-4）へ遷移する
* 管理者認証成功後、履歴一覧画面（S-5）へ遷移する
* 各操作完了後はトップ画面（S-1）へ戻る

---

## 画面遷移図（概念表現）

```
[S-1 トップ画面]
   |  貸出
   v
[S-2 鍵の貸出画面]
   |  完了
   v
[S-1 トップ画面]

[S-1 トップ画面]
   |  返却
   v
[S-3 鍵の返却画面]
   |  完了
   v
[S-1 トップ画面]

[S-1 トップ画面]
   |  管理者ログイン
   v
[S-4 管理者ログイン画面]
   |  認証成功
   v
[S-5 履歴一覧画面]
   |  戻る
   v
[S-1 トップ画面]
```

---

## 補足

* トップ画面を中心とした単純な遷移構造とすることで、操作の分かりやすさを重視する
* 管理者向け機能はログイン後のみ利用可能とし、一般利用者との権限分離を行う

---

# 詳細設計への移行

本章では、外部設計（要求定義・DFD・画面遷移図・ER図）をもとに、実装可能なレベルまで設計を詳細化する。

## 詳細設計で扱う範囲

詳細設計では以下を定義する。

1. 画面項目定義
2. 入力チェック・エラーハンドリング
3. 処理フロー（画面単位）
4. データ操作仕様（CRUD）

---

## 1. 画面一覧

| 画面ID | 画面名       | 利用者種別 |
| :--- | :-------- | :---- |
| S-1  | トップ画面     | 全利用者  |
| S-2  | 鍵貸出画面     | 利用者   |
| S-3  | 鍵返却画面     | 利用者   |
| S-4  | 管理者ログイン画面 | 管理者   |
| S-5  | 履歴閲覧画面    | 管理者   |

---

## 2. 画面項目定義

### S-1 トップ画面

| 項目名      | 種別   | 必須 | 説明                 |
| -------- | ---- | -- | ------------------ |
| 鍵を借りるボタン | ボタン  | ―  | 鍵貸出画面（S-02）へ遷移     |
| 鍵を返すボタン  | ボタン  | ―  | 鍵返却画面（S-03）へ遷移     |
| 管理者用ボタン  | ボタン  | ―  | 管理者ログイン画面（S-04）へ遷移 |
| メッセージ表示欄 | テキスト | ―  | システム案内や注意事項を表示     |

### S-2 鍵貸出画面

| 項目名      | 種別    | 必須 | 説明               |
| -------- | ----- | -- | ---------------- |
| 学籍番号選択   | プルダウン | ○  | 登録済み利用者の学籍番号を選択  |
| 氏名表示     | テキスト  | ―  | 学籍番号に対応する氏名を自動表示 |
| 鍵選択      | プルダウン | ○  | 保管中（貸出可能）の鍵のみ表示  |
| 鍵一覧表示    | テキスト  | ―  | 現在保管中の鍵一覧を表示     |
| 貸出ボタン    | ボタン   | ―  | 貸出処理を実行          |
| 戻るボタン    | ボタン   | ―  | トップ画面（S-01）へ戻る   |
| エラーメッセージ | テキスト  | ―  | 入力不足・貸出不可時に表示    |


### S-3 鍵返却画面

| 項目名      | 種別    | 必須 | 説明               |
| -------- | ----- | -- | ---------------- |
| 学籍番号選択   | プルダウン | ○  | 登録済み利用者の学籍番号を選択  |
| 氏名表示     | テキスト  | ―  | 学籍番号に対応する氏名を自動表示 |
| 鍵選択      | プルダウン | ○  | 当該利用者が貸出中の鍵のみ表示  |
| 貸出中鍵一覧   | テキスト  | ―  | 現在貸出中の鍵を表示       |
| 返却ボタン    | ボタン   | ―  | 返却処理を実行          |
| 戻るボタン    | ボタン   | ―  | トップ画面（S-01）へ戻る   |
| エラーメッセージ | テキスト  | ―  | 入力不備・返却不可時に表示    |

### S-4 管理者ログイン画面

| 項目名      | 種別       | 必須 | 説明             |
| -------- | -------- | -- | -------------- |
| 学籍番号入力   | テキストボックス | ○  | 管理者の学籍番号を入力    |
| パスワード入力  | パスワード    | ○  | 管理者パスワードを入力    |
| ログインボタン  | ボタン      | ―  | 認証処理を実行        |
| 戻るボタン    | ボタン      | ―  | トップ画面（S-01）へ戻る |
| エラーメッセージ | テキスト     | ―  | 認証失敗時に表示       |


### S-5 履歴閲覧画面

| 項目名    | 種別   | 必須 | 説明              |
| ------ | ---- | -- | --------------- |
| 履歴一覧表示 | テーブル | ―  | 貸出・返却履歴を一覧表示    |
| 出力ボタン  | ボタン  | ―  | 履歴をCSV形式でダウンロード |
| 戻るボタン  | ボタン  | ―  | トップ画面（S-01）へ戻る  |


---

## 3. 入力チェック仕様

### S-2 鍵貸出画面

| チェック内容 | 対象    | エラー時動作    |
| :----- | :---- | :-------- |
| 利用者未選択 | 利用者選択 | メッセージ表示   |
| 鍵未選択   | 鍵選択   | メッセージ表示   |
| 鍵が貸出中  | 鍵選択   | 処理中断・警告表示 |

### S-3 鍵返却画面

| チェック内容       | 対象        | エラー時動作    |
| :----------- | :-------- | :-------- |
| 利用者未選択       | 利用者選択     | メッセージ表示   |
| 鍵未選択         | 鍵選択       | メッセージ表示   |
| 鍵が貸出中でない     | 鍵選択       | 処理中断・警告表示 |

### S-4 管理者ログイン画面

| チェック内容     | 対象       | エラー時動作     |
| :--------- | :------- | :--------- |
| 学籍番号未入力    | 学籍番号入力欄  | メッセージ表示    |
| パスワード未入力   | パスワード入力欄 | メッセージ表示    |
| 学籍番号が存在しない | 学籍番号入力欄  | エラーメッセージ表示 |
| パスワード不一致   | パスワード入力欄 | エラーメッセージ表示 |

### S-5 履歴閲覧画面

| チェック内容  | 対象    | エラー時動作        |
| :------ | :---- | :------------ |
| 管理者未認証  | 画面遷移時 | ログイン画面へリダイレクト |
| 履歴データなし | 履歴一覧  | 「データなし」を表示    |
| 出力失敗    | 出力ボタン | エラーメッセージ表示    |

---

## 4. 処理フロー

### S-1 トップ画面
#### 正常系フロー

1. システムがトップ画面を表示する
2. 利用者が以下いずれかのボタンを押下する
    * 鍵を借りる
    * 鍵を返す
    * 管理者用
3. 押下されたボタンに応じて、対応する画面へ遷移する

### S-2 鍵貸出画面

#### 正常系フロー

1. システムが利用者一覧および貸出可能な鍵一覧を表示する
2. 利用者が学籍番号を選択する
3. システムが対応する氏名を表示する
4. 利用者が借用する鍵を選択する
5. 利用者が貸出ボタンを押下する
6. システムが以下を実行する
    * 貸出履歴を登録
    * 鍵の状態を「貸出中」に更新
7. トップ画面へ遷移する

#### 異常系フロー

* 利用者未選択
* 鍵未選択
* 鍵がすでに貸出中

    → エラーメッセージを表示し、処理を中断して画面を保持する


### S-3 鍵返却画面

#### 正常系フロー

1. システムが利用者一覧を表示する
2. 利用者が学籍番号を選択する
3. システムが氏名および当該利用者が借用中の鍵一覧を表示する
4. 利用者が返却する鍵を選択する
5. 利用者が返却ボタンを押下する
6. システムが以下を実行する
    * 貸出履歴に返却日時を記録
    * 鍵の状態を「保管中」に更新
7. トップ画面へ遷移する

#### 異常系フロー

* 利用者未選択
* 鍵未選択
* 鍵が貸出中でない
* 利用者と貸出履歴が一致しない

    → エラーメッセージを表示し、処理を中断して画面を保持する

### S-4 管理者ログイン画面

#### 正常系フロー

1. システムが管理者ログイン画面を表示する
2. 管理者が学籍番号とパスワードを入力する
3. 管理者がログインボタンを押下する
4. システムが以下を検証する
    * 学籍番号の存在
    * パスワードの一致
    * 管理者権限の有無
5. 認証成功時、履歴一覧画面へ遷移する

#### 異常系フロー

* 学籍番号未入力
* パスワード未入力
* 認証失敗（番号不正・パスワード不一致）
* 管理者権限なし

    → エラーメッセージを表示し、再入力を促す

### S-5 履歴一覧画面

#### 正常系フロー

1. システムが管理者認証済みであることを確認する
2. 貸出・返却履歴を一覧表示する
3. 管理者が出力ボタンを押下した場合
    * 履歴データをCSV形式で出力する
4. 戻るボタン押下でトップ画面へ遷移する

#### 異常系フロー

* 管理者未認証で画面遷移が行われた場合

    → 管理者ログイン画面へリダイレクト

* 履歴データが存在しない場合

    → 「データなし」と表示する

* 出力処理失敗

    → エラーメッセージを表示する

---